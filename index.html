<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGORA Master - Pro Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent: #6366f1; --accent-glow: rgba(99, 102, 241, 0.4);
            --bg: #0f172a; --card-bg: rgba(30, 41, 59, 0.7);
            --success: #22c55e; --error: #ef4444; --text: #f8fafc;
        }
        * { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { 
            background: radial-gradient(circle at top right, #1e1b4b, var(--bg)); 
            color: var(--text); margin: 0; min-height: 100vh; overflow-x: hidden;
        }

        /* Nav & Stats */
        header {
            padding: 20px; display: flex; justify-content: space-between; align-items: center;
            backdrop-filter: blur(10px); sticky; top: 0; z-index: 100;
        }
        .xp-badge {
            background: var(--accent); padding: 8px 16px; border-radius: 20px;
            font-weight: 800; box-shadow: 0 0 15px var(--accent-glow);
        }

        /* Menu Principal */
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .mode-selector { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px;
        }
        .mode-btn {
            background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1);
            padding: 20px; border-radius: 16px; color: white; cursor: pointer;
            text-align: center; transition: 0.3s;
        }
        .mode-btn:hover { border-color: var(--accent); transform: translateY(-3px); }
        .mode-btn.active { background: var(--accent); }

        /* Grille Pix */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; }
        .card {
            background: var(--card-bg); border-radius: 20px; padding: 25px;
            border: 1px solid rgba(255,255,255,0.05); position: relative; overflow: hidden;
        }
        .progress-ring {
            position: absolute; top: 15px; right: 15px; font-size: 12px;
            background: rgba(0,0,0,0.3); padding: 5px 10px; border-radius: 10px;
        }

        /* Interface Quiz */
        .hidden { display: none; }
        .option {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1);
            padding: 18px; border-radius: 12px; margin: 12px 0; cursor: pointer; transition: 0.2s;
        }
        .option:hover { background: rgba(255,255,255,0.08); }
        .correct { background: var(--success) !important; border-color: transparent !important; }
        .incorrect { background: var(--error) !important; border-color: transparent !important; }

        .feedback-box {
            margin-top: 20px; padding: 20px; border-radius: 12px;
            background: rgba(99, 102, 241, 0.1); border-left: 4px solid var(--accent);
        }
        .btn-action {
            background: var(--accent); color: white; border: none; padding: 15px 30px;
            border-radius: 12px; font-weight: 600; width: 100%; cursor: pointer; margin-top: 20px;
        }

        /* Fiches R√©vision */
        .fiche { background: var(--card-bg); padding: 30px; border-radius: 24px; line-height: 1.6; }
        .fiche h2 { color: var(--accent); border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        
        /* Animation R√©ussite */
        @keyframes successPop {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>

<header>
    <div style="font-size: 24px; font-weight: 800;">AGORA<span style="color:var(--accent)">MASTER</span></div>
    <div class="xp-badge" id="global-xp">0 XP</div>
</header>

<div class="container">
    <div class="mode-selector">
        <div class="mode-btn active" id="btn-train" onclick="switchMode('train')">üéÆ Entra√Ænement</div>
        <div class="mode-btn" id="btn-rev" onclick="switchMode('rev')">üìñ R√©visions</div>
    </div>

    <div id="view-train">
        <div class="grid" id="themes-grid"></div>
        <h3 style="margin-top:40px;">üïµÔ∏è D√©fis Sp√©ciaux</h3>
        <div class="grid">
            <div class="card" onclick="startSpecial('detective')">
                <h4>Mode D√©tective</h4>
                <p style="font-size:14px; opacity:0.7;">Trouve les erreurs dans les documents RH[cite: 275].</p>
            </div>
            <div class="card" onclick="startSpecial('manager')">
                <h4>Mode Manager</h4>
                <p style="font-size:14px; opacity:0.7;">Prends les bonnes d√©cisions administratives[cite: 302].</p>
            </div>
        </div>
    </div>

    <div id="view-rev" class="hidden">
        <div class="grid" id="fiches-list"></div>
    </div>

    <div id="view-quiz" class="hidden">
        <button onclick="exitQuiz()" style="background:none; border:none; color:white; cursor:pointer; margin-bottom:20px;">‚Üê Quitter</button>
        <div id="quiz-content">
            <div id="q-meta" style="color:var(--accent); font-weight:600; margin-bottom:10px;"></div>
            <h2 id="q-text" style="margin-top:0;"></h2>
            <div id="options-box"></div>
            <div id="feedback-area" class="hidden">
                <div class="feedback-box" id="fb-text"></div>
                <button class="btn-action" onclick="handleNext()">Question suivante</button>
            </div>
        </div>
    </div>

    <div id="view-fiche-detail" class="hidden">
        <button onclick="switchMode('rev')" style="background:none; border:none; color:white; cursor:pointer; margin-bottom:20px;">‚Üê Retour</button>
        <div id="fiche-content" class="fiche"></div>
    </div>
</div>

<script>
    // Donn√©es consolid√©es depuis le Guide RH [cite: 3, 24, 40, 63, 76]
    const db = {
        themes: [
            { id: 'T1', title: 'Recrutement', icon: 'üë§', questions: [
                { q: "Diff√©rence fondamentale entre recrutement interne et externe ?", options: ["L'interne est plus cher", "L'interne cible le personnel actuel, l'externe le march√© du travail", "L'externe est r√©serv√© aux cadres"], ans: 1, expl: "Le recrutement interne s'adresse aux salari√©s d√©j√† pr√©sents[cite: 6, 167]." },
                { q: "Qu'est-ce qu'une fiche de poste ?", options: ["Le CV du candidat", "Description des missions, t√¢ches et place dans l'organigramme", "Uniquement les dipl√¥mes"], ans: 1, expl: "Elle d√©crit les missions et les conditions de travail[cite: 9, 171]." },
                { q: "Quand faire la DPAE ?", options: ["Apr√®s la p√©riode d'essai", "Dans les 8 jours pr√©c√©dant l'embauche", "Le jour du premier salaire"], ans: 1, expl: "Formalit√© obligatoire √† faire aupr√®s de l'URSSAF avant l'embauche[cite: 91, 185]." }
            ]},
            { id: 'T3', title: 'Gestion Administrative', icon: 'üìÇ', questions: [
                { q: "Sanction pour non-tenue du registre du personnel ?", options: ["135 ‚Ç¨", "750 ‚Ç¨ par salari√© concern√©", "Aucune sanction"], ans: 1, expl: "L'employeur encourt jusqu'√† 750‚Ç¨ d'amende par salari√©[cite: 48, 105]." },
                { q: "Quand l'avenant au contrat est-il obligatoire ?", options: ["Changement de num√©ro de mobile", "Modification d'un √©l√©ment essentiel (salaire, lieu, poste)", "Changement de banque"], ans: 1, expl: "Requis pour toute modif de r√©mun√©ration, dur√©e ou lieu[cite: 52, 109]." }
            ]}
        ],
        fiches: [
            { id: 'F1', title: 'Recrutement & Int√©gration', content: `<h2>Pr√©parer le recrutement</h2><ul><li><b>Fiche de poste :</b> Missions, t√¢ches [cite: 82].</li><li><b>Profil de poste :</b> Dipl√¥mes, savoir-√™tre [cite: 83].</li></ul><h2>DPAE</h2>Obligatoire dans les 8 jours avant l'embauche[cite: 91].` },
            { id: 'F2', title: 'Contrat & Registre', content: `<h2>Le Registre du Personnel</h2>Obligatoire d√®s le 1er salari√©[cite: 102]. Conservation : 5 ans apr√®s le d√©part[cite: 106, 375].` }
        ],
        special: {
            detective: [
                { q: "SC√âNARIO : Dans le Registre du Personnel, Luis (entr√© le 10) est inscrit apr√®s Jean (entr√© le 12). Quelle est l'erreur ?", options: ["Aucune erreur", "L'ordre chronologique d'embauche n'est pas respect√©", "Le nom est mal √©crit"], ans: 1, expl: "L'enregistrement doit se faire par ordre chronologique d'embauche[cite: 403, 405]." }
            ],
            manager: [
                { q: "SITUATION : Gloria va avoir une augmentation. Que faites-vous ?", options: ["Simple SMS", "Changement uniquement sur le bulletin de paie", "R√©daction d'un avenant au contrat"], ans: 2, expl: "C'est une modification d'un √©l√©ment essentiel du contrat[cite: 307, 308]." }
            ]
        }
    };

    let state = JSON.parse(localStorage.getItem('agoraMaster_state')) || { xp: 0, progress: {} };
    let currentQuiz = null; let qIdx = 0; let canAnswer = true;

    function save() { localStorage.setItem('agoraMaster_state', JSON.stringify(state)); }

    function switchMode(mode) {
        document.getElementById('view-train').classList.toggle('hidden', mode !== 'train');
        document.getElementById('view-rev').classList.toggle('hidden', mode !== 'rev');
        document.getElementById('view-quiz').classList.add('hidden');
        document.getElementById('view-fiche-detail').classList.add('hidden');
        document.getElementById('btn-train').classList.toggle('active', mode === 'train');
        document.getElementById('btn-rev').classList.toggle('active', mode === 'rev');
        if(mode === 'train') renderTrain(); else renderRev();
    }

    function renderTrain() {
        const container = document.getElementById('themes-grid');
        container.innerHTML = db.themes.map(t => `
            <div class="card" onclick="startQuiz('theme', '${t.id}')">
                <div class="progress-ring">${state.progress[t.id] || 0}%</div>
                <div style="font-size:32px; margin-bottom:10px;">${t.icon}</div>
                <h4 style="margin:0;">${t.title}</h4>
            </div>
        `).join('');
        document.getElementById('global-xp').innerText = `${state.xp} XP`;
    }

    function renderRev() {
        const container = document.getElementById('fiches-list');
        container.innerHTML = db.fiches.map(f => `
            <div class="card" onclick="showFiche('${f.id}')">
                <h4>${f.title}</h4>
                <p style="font-size:12px; opacity:0.6;">Cliquez pour lire la synth√®se</p>
            </div>
        `).join('');
    }

    function showFiche(id) {
        const fiche = db.fiches.find(f => f.id === id);
        document.getElementById('view-rev').classList.add('hidden');
        document.getElementById('view-fiche-detail').classList.remove('hidden');
        document.getElementById('fiche-content').innerHTML = fiche.content;
    }

    function startQuiz(type, id) {
        if(type === 'theme') currentQuiz = db.themes.find(t => t.id === id).questions;
        else currentQuiz = db.special[id];
        
        currentQuizId = id; qIdx = 0;
        document.getElementById('view-train').classList.add('hidden');
        document.getElementById('view-quiz').classList.remove('hidden');
        showQuestion();
    }

    function showQuestion() {
        canAnswer = true;
        const q = currentQuiz[qIdx];
        document.getElementById('q-meta').innerText = `QUESTION ${qIdx + 1} / ${currentQuiz.length}`;
        document.getElementById('q-text').innerText = q.q;
        document.getElementById('feedback-area').classList.add('hidden');
        
        const box = document.getElementById('options-box');
        box.innerHTML = q.options.map((opt, i) => `
            <div class="option" onclick="checkAnswer(${i}, this)">${opt}</div>
        `).join('');
    }

    function checkAnswer(idx, el) {
        if(!canAnswer) return; canAnswer = false;
        const q = currentQuiz[qIdx];
        const isCorrect = idx === q.ans;
        
        if(isCorrect) {
            el.classList.add('correct');
            state.xp += 25; // Points gagn√©s SEULEMENT en cas de r√©ussite
        } else {
            el.classList.add('incorrect');
            document.querySelectorAll('.option')[q.ans].classList.add('correct');
        }
        
        document.getElementById('fb-text').innerText = q.expl;
        document.getElementById('feedback-area').classList.remove('hidden');
        save();
    }

    function handleNext() {
        qIdx++;
        if(qIdx < currentQuiz.length) showQuestion();
        else exitQuiz(true);
    }

    function exitQuiz(finished = false) {
        if(finished) state.progress[currentQuizId] = 100;
        save();
        document.getElementById('view-quiz').classList.add('hidden');
        switchMode('train');
    }

    function startSpecial(mode) { startQuiz('special', mode); }

    renderTrain();
</script>
</body>
</html>
